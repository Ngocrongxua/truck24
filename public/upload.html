<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Upload Skin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Check ƒëƒÉng nh·∫≠p tr∆∞·ªõc khi cho upload
    async function checkLogin() {
      const res = await fetch('/api/me');
      const data = await res.json();
      if (!data.isLoggedIn) {
        alert('B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p tr∆∞·ªõc khi upload skin!');
        window.location.href = '/'; // quay v·ªÅ trang ch√≠nh
      } else {
        document.getElementById('username').textContent = data.displayName;
      }
    }

    // Hi·ªán dung l∆∞·ª£ng file ƒë√£ ch·ªçn
    function showFileSize(input, labelId) {
      const file = input.files[0];
      if (file) {
        const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
        document.getElementById(labelId).textContent = `ƒê√£ ch·ªçn: ${file.name} (${sizeMB} MB)`;

        // Gi·ªõi h·∫°n 20MB
        if (file.size > 20 * 1024 * 1024) {
          alert("File v∆∞·ª£t qu√° 20MB!");
          input.value = ""; // reset input
          document.getElementById(labelId).textContent = "";
        }
      } else {
        document.getElementById(labelId).textContent = "";
      }
    }

    window.onload = checkLogin;
  </script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="bg-white p-6 rounded-lg shadow-md w-full max-w-2xl">
    <h2 class="text-2xl font-bold mb-4">Upload Skin</h2>
    <p class="mb-4 text-gray-600">Xin ch√†o <span id="username" class="font-semibold">...</span> üëã</p>

    <form id="uploadForm" enctype="multipart/form-data" class="space-y-4">
  <!-- T√™n skin -->
  <div>
    <label class="block mb-1 font-medium">T√™n Skin</label>
    <input type="text" name="skinTitle" required class="w-full p-2 border rounded">
  </div>

  <!-- Game -->
  <div>
    <label class="block mb-1 font-medium">Ch·ªçn Game</label>
    <select name="skinGame" required class="w-full p-2 border rounded">
      <option value="">-- Ch·ªçn Game --</option>
      <option value="truckers-of-europe-3">Truckers of Europe 3</option>
      <option value="bus-simulator-indonesia">Bus Simulator Indonesia</option>
      <option value="world-truck-driving-simulator">World Truck Driving Simulator</option>
      <option value="other">Kh√°c</option>
    </select>
  </div>

  <!-- Lo·∫°i xe -->
  <div>
    <label class="block mb-1 font-medium">Lo·∫°i</label>
    <select name="skinType" required class="w-full p-2 border rounded">
      <option value="xe_khach">Xe kh√°ch</option>
      <option value="xe_tai">Xe t·∫£i</option>
      <option value="phu_kien">Ph·ª• ki·ªán</option>
      <option value="khac">Kh√°c</option>
    </select>
  </div>

  <!-- ·∫¢nh demo -->
  <div>
    <label class="block mb-1 font-medium">·∫¢nh demo (1 ·∫£nh)</label>
    <input type="file" name="demoImage" accept="image/*" required>
  </div>

  <!-- ·∫¢nh trong game -->
  <div>
    <label class="block mb-1 font-medium">·∫¢nh trong game (t·ªëi ƒëa 2)</label>
    <input type="file" name="inGameImages" accept="image/*" multiple>
  </div>

  <!-- File skin -->
  <div>
    <label class="block mb-1 font-medium">File Skin (.zip, .rar, .7z, .scs, ho·∫∑c ·∫£nh)</label>
    <input type="file" name="skinFile" 
           accept=".zip,.rar,.7z,.scs,image/*" 
           required 
           onchange="showFileSize(this, 'skinFileInfo')">
    <p id="skinFileInfo" class="text-sm text-gray-600 mt-1"></p>
  </div>

  <!-- M√¥ t·∫£ -->
  <div>
    <label class="block mb-1 font-medium">M√¥ t·∫£ (t√πy ch·ªçn)</label>
    <textarea name="description" rows="4" class="w-full p-2 border rounded"></textarea>
  </div>

  <!-- N√∫t submit -->
  <button type="submit" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">
    üöÄ T·∫£i l√™n Skin
  </button>
</form>

<!-- ‚úÖ Th√¥ng b√°o th√†nh c√¥ng -->
<div id="uploadMessage" class="hidden text-green-600 mt-4 text-center font-semibold">
  üéâ Upload th√†nh c√¥ng! ƒêang ch·ªù admin duy·ªát...
</div>

<!-- ‚úÖ Script x·ª≠ l√Ω upload -->
<script>
  document.getElementById('uploadForm').addEventListener('submit', async function (e) {
    e.preventDefault();

    const form = e.target;
    const formData = new FormData(form);

    try {
      const res = await fetch('/upload-skin', {
        method: 'POST',
        body: formData
      });

      if (res.ok) {
        const msg = document.getElementById('uploadMessage');
        msg.classList.remove('hidden');

        // 3 gi√¢y sau chuy·ªÉn v·ªÅ trang ch·ªß
        setTimeout(() => {
          window.location.href = "/";
        }, 3000);
      } else {
        const text = await res.text();
        alert("‚ùå Upload th·∫•t b·∫°i: " + text);
      }
    } catch (err) {
      alert("‚ùå L·ªói khi upload: " + err.message);
    }
  });
</script>

  </div>
</body>
</html>
